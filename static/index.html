<!DOCTYPE html>
<html>
<body>
<h1>Lightning-Lotto!</h1>
<h3>{{.pot}} sats and counting... Awarded in:</h2>
<h2 id=countdown_timer></h2>

<div id="invoice">
<h2>Add</h2>
<form id="add_ticket">
  <label for="fname">NodeID to pay out on win:</label><br>
  <input type="text" name="node_id" value="03ef68ccd4b33ae540aea5bf91fcfc70137e031e0cf3823a958c3c3d69239eb7cd"><br>
  <label for="lname">Amount in Satoshis</label><br>
  <input type="text" name="sats" value="10"><br><br>
  <input type="submit" value="Submit">
</form>
</div>

<h2>Participants</h2>

<ul>
  {{range .payload}}
  <li>Alias: {{.NodeID}} Tickets: {{.AmountSats}}</li>
  {{ end }}
</ul>

<h2>Winners</h2>

<ul>
  {{range .winners}}
  <li>Alias: {{.NodeID}} Amount: {{.AmountSats}}</li>
  {{ end }}
</ul>

<script>
	const countDownDate = new Date().getTime() + {{.time_left_ms}}
	const form = document.getElementById('add_ticket');

	form.addEventListener('submit', (event) => {
		event.preventDefault();
		let node_id = form.elements['node_id'].value;
		let sats = form.elements['sats'].value;

		const xhttp = new XMLHttpRequest();
		xhttp.onload = function() {
			document.getElementById("invoice").innerHTML = this.responseText;
		}
		url = "/add_ticket_request?node_id=" +  node_id +"&amount=" + sats
		xhttp.open("GET", url, true);
		xhttp.send();
	});

	render_countdown_timer()
	var x = setInterval(render_countdown_timer, 1000);
	function render_countdown_timer() {
		var now = new Date().getTime();
		var duration = countDownDate - now;
		if (duration <= 0) {
			duration = 0
			location.reload();
		}
		var minutes = Math.floor((duration % (1000 * 60 * 60)) / (1000 * 60));
		var seconds = Math.floor((duration % (1000 * 60)) / 1000);
		document.getElementById("countdown_timer").innerHTML = minutes + "m " + seconds + "s ";

	}
</script>

</body>
</html>
